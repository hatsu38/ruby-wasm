<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>Ruby WASM Regex Tester</title>
    <meta charset="utf-8"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ruby-head-wasm-wasi@latest/dist/browser.script.iife.js"></script>
    <script type="text/ruby">
      # frozen_string_literal: true

      require 'js'
      
      def document
        @document ||= JS.global[:document]
      end
      
      def test_regex(pattern, text)
        regex = Regexp.new(pattern)
        if (match = regex.match(text))
          highlighted_text = text.sub(regex, "<span class='bg-yellow-400 text-black px-1 font-bold'>#{match}</span>")
          status_message = "<span class='text-green-500'>マッチしました</span>"
          result = highlighted_text
        else
          status_message = "<span class='text-red-500'>マッチしませんでした。</span>"
          result = ''
        end
        document.getElementById('statusMessage')[:innerHTML] = status_message
        document.getElementById('result')[:innerHTML] = result
      end
      
      button = document.getElementById('runButton')
      regex_input = document.getElementById('regex')
      test_input = document.getElementById('testString')
      
      button.addEventListener 'click' do
        test_regex(regex_input[:value].to_s, test_input[:value].to_s)
      end      
    </script>
  </head>
  <body class="bg-gray-800 p-5 text-white">
    <div class="max-w-xl mx-auto bg-gray-700 border border-gray-600 shadow-lg rounded p-5">
        <label for="regex" class="block text-sm font-bold mb-2">正規表現:</label>
        <input type="text" id="regex" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 bg-gray-800 leading-tight focus:outline-none focus:shadow-outline" value="https?:\/\/[\w]+\.[\w]+(?:\.[\w]+)+[\/\w._?%&=-]*">

        <label for="testString" class="block text-sm font-bold mb-2 mt-4">テスト文字列:</label>
        <textarea id="testString" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 bg-gray-800 leading-tight focus:outline-none focus:shadow-outline" rows="4">こちらはテスト文章です。URLの例: https://www.example.com</textarea>

        <button id="runButton" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">正規表現をテスト</button>

        <div class="text-sm mt-4 p-3">
          <span>実行結果：</span>
          <span id="statusMessage">-</span>
        </div>
        <div id="result" class="text-sm mt-4 p-3 border border-gray-600 rounded bg-gray-900"> </div>
    </div>
  </body>
</html>
